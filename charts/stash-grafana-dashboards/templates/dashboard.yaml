{{ range .Values.resources }}
{{ range $path, $_ :=  $.Files.Glob (printf "dashboards/%s/**.json" .) }}
apiVersion: openviz.dev/v1alpha1
kind: GrafanaDashboard
metadata:
  name: {{ printf "%s-%s" $.Values.grafana.name ((get ($.Files.Get $path | mustFromJson) "title") | lower | nospace | replace "/" "-" ) | trunc 63 | trimSuffix "-" }}
  namespace: {{ $.Release.Namespace }}
  labels:
    k8s.io/group: stash.appscode.com
    {{- include "stash-grafana-dashboards.labels" $ | nindent 4 }}
spec:
{{- if or $.Values.grafana.name $.Values.grafana.namespace }}
  grafanaRef:
  {{- with $.Values.grafana.name }}
    name: {{ . }}
  {{- end }}
  {{- with $.Values.grafana.namespace }}
    namespace: {{ . }}
  {{- end }}
{{- end }}
  model:
    {{- omit ($.Files.Get $path | mustFromJson) "id" "uid" | toYaml | nindent 4 }}
{{- with $.Values.dashboard.folderID }}
  folderID: {{ . }}
{{- end }}
  overwrite: {{ $.Values.dashboard.overwrite }}
  templatize:
    title: {{ $.Values.dashboard.templatize.title }}
    datasource: {{ $.Values.dashboard.templatize.datasource }}
---
{{ end }}
{{ end }}
